---
import ThemeToggle from "./ThemeToggle.astro";

const navItems = [
    { label: "Projects", href: "#projects" },
    { label: "Skills", href: "#skills" },
    { label: "Experience", href: "#experience" },
    { label: "About", href: "#about" },
];
---

<header class="header" role="banner">
    <div class="header-container">
        <div class="header-logo-wrapper">
            <span class="logo">Portfolio</span>
        </div>

        <!-- Desktop Navigation -->
        <nav class="header-nav-desktop nav" aria-label="Main navigation">
            {
                navItems.map((item) => (
                    <button data-nav-link data-href={item.href} class="nav-item">
                        {item.label}
                    </button>
                ))
            }
            <ThemeToggle />
        </nav>

        <!-- Mobile Actions -->
        <div class="header-nav-mobile nav">
            <ThemeToggle />
            <button
                id="mobile-menu-button"
                class="mobile-menu-button"
                aria-label="Toggle navigation menu"
                aria-expanded="false"
                aria-controls="mobile-menu"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <line x1="4" x2="20" y1="12" y2="12"></line>
                    <line x1="4" x2="20" y1="6" y2="6"></line>
                    <line x1="4" x2="20" y1="18" y2="18"></line>
                </svg>
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu hidden">
        <nav class="mobile-menu-nav" aria-label="Mobile navigation">
            {
                navItems.map((item) => (
                    <button
                        data-nav-link
                        data-href={item.href}
                        class="mobile-nav-item"
                    >
                        {item.label}
                    </button>
                ))
            }
        </nav>
    </div>
</header>

<script>
    function initializeHeader() {
        // Mobile menu toggle
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");

        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener("click", () => {
                const isExpanded = mobileMenuButton.getAttribute("aria-expanded") === "true";
                mobileMenuButton.setAttribute("aria-expanded", String(!isExpanded));
                mobileMenu.classList.toggle("hidden");
            });
        }

        // Smooth scroll navigation
        const navLinks = document.querySelectorAll("[data-nav-link]");

        navLinks.forEach((link) => {
            link.addEventListener("click", (e) => {
                const href = link.getAttribute("data-href");
                if (href) {
                    const element = document.querySelector(href);
                    if (element) {
                        element.scrollIntoView({ behavior: "smooth", block: "start" });
                        // Close mobile menu if open
                        if (mobileMenu) {
                            mobileMenu.classList.add("hidden");
                        }
                        if (mobileMenuButton) {
                            mobileMenuButton.setAttribute("aria-expanded", "false");
                        }
                    }
                }
            });
        });

        // Close menu on escape key
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && mobileMenu && !mobileMenu.classList.contains("hidden")) {
                mobileMenu.classList.add("hidden");
                if (mobileMenuButton) {
                    mobileMenuButton.setAttribute("aria-expanded", "false");
                    mobileMenuButton.focus();
                }
            }
        });
    }

    // Execute immediately if DOM is already loaded, otherwise wait for DOMContentLoaded
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializeHeader);
    } else {
        initializeHeader();
    }
</script>
