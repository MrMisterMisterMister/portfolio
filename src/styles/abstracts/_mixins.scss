// ============================================================================
// REUSABLE MIXINS
// ============================================================================
// Collection of reusable mixins for common CSS patterns, responsive design,
// and consistent component styling.
//
// @layer: Abstracts - Settings only, no CSS output
// @category: Mixins
// ============================================================================

@use "sass:list";
@use "sass:map";
@use "sass:meta";
@use "variables" as *;
@use "functions" as fn;

// ============================================================================
// RESPONSIVE MIXINS
// ============================================================================
// Media query mixins for responsive design following mobile-first approach.
// ============================================================================

// Breakpoint mixin for responsive design (min-width)
// @param {String} $breakpoint - Breakpoint name (sm, md, lg, xl, etc.)
// @content - CSS rules to apply at this breakpoint and above
// @example scss
//   .element {
//     font-size: 1rem;
//     @include bp(md) {
//       font-size: 1.5rem;
//     }
//   }
@mixin bp($breakpoint) {
    $value: breakpoint($breakpoint);
    @if $value {
        @media (min-width: $value) {
            @content;
        }
    } @else {
        @warn "Breakpoint `#{$breakpoint}` not found in $breakpoints map.";
    }
}

// Breakpoint mixin for max-width (mobile-first reversed)
// @param {String} $breakpoint - Breakpoint name
// @content - CSS rules to apply below this breakpoint
// @example scss
//   .element {
//     display: block;
//     @include bp-down(md) {
//       display: none;
//     }
//   }
@mixin bp-down($breakpoint) {
    $value: breakpoint($breakpoint);
    @if $value {
        @media (max-width: calc($value - 1px)) {
            @content;
        }
    } @else {
        @warn "Breakpoint `#{$breakpoint}` not found in $breakpoints map.";
    }
}

// Breakpoint range mixin (between two breakpoints)
// @param {String} $min - Minimum breakpoint name
// @param {String} $max - Maximum breakpoint name
// @content - CSS rules to apply within range
// @example scss
//   @include bp-between(sm, lg) {
//     display: flex;
//   }
@mixin bp-between($min, $max) {
    $min-value: breakpoint($min);
    $max-value: breakpoint($max);
    @if $min-value and $max-value {
        @media (min-width: $min-value) and (max-width: calc($max-value - 1px)) {
            @content;
        }
    } @else {
        @warn "Breakpoints not found in $breakpoints map.";
    }
}

// Custom media query mixin
// @param {String} $query - Custom media query
// @content - CSS rules
// @example scss
//   @include media("(orientation: landscape)") {
//     width: 100vw;
//   }
@mixin media($query) {
    @media #{$query} {
        @content;
    }
}

// ============================================================================
// LAYOUT MIXINS
// ============================================================================

// Flexbox container mixin
// @param {String} $direction - Flex direction (row, column, etc.)
// @param {String} $justify - Justify content
// @param {String} $align - Align items
// @param {String} $wrap - Flex wrap
// @param {String} $gap - Gap between items
// @example scss
//   @include flex(row, center, center, nowrap, spacing(md));
@mixin flex(
    $direction: row,
    $justify: flex-start,
    $align: stretch,
    $wrap: nowrap,
    $gap: null
) {
    display: flex;
    flex-direction: $direction;
    justify-content: $justify;
    align-items: $align;
    flex-wrap: $wrap;

    @if $gap {
        gap: $gap;
    }
}

// Grid container mixin
// @param {Number|String} $columns - Grid template columns
// @param {Number|String} $rows - Grid template rows (optional)
// @param {String} $gap - Gap between items
// @example scss
//   @include grid(repeat(3, 1fr), auto, spacing(lg));
@mixin grid($columns: 1fr, $rows: null, $gap: null) {
    display: grid;
    grid-template-columns: $columns;

    @if $rows {
        grid-template-rows: $rows;
    }

    @if $gap {
        gap: $gap;
    }
}

// Center element (absolute positioning)
// @param {String} $position - Positioning type (absolute, fixed)
// @example scss
//   @include center-absolute();
@mixin center-absolute($position: absolute) {
    position: $position;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

// Center child elements
// @param {String} $direction - Direction (both, horizontal, vertical)
// @example scss
//   @include center-children(both);
@mixin center-children($direction: both) {
    display: flex;

    @if $direction == both {
        justify-content: center;
        align-items: center;
    } @else if $direction == horizontal {
        justify-content: center;
    } @else if $direction == vertical {
        align-items: center;
    }
}

// Container with max-width and centered
// @param {String} $size - Container size key (sm, md, lg, xl, 2xl)
// @param {String} $padding - Horizontal padding
// @example scss
//   @include container(xl, spacing(lg));
@mixin container($size: 2xl, $padding: spacing(lg)) {
    width: 100%;
    max-width: container($size);
    margin-left: auto;
    margin-right: auto;
    padding-left: $padding;
    padding-right: $padding;
}

// ============================================================================
// TYPOGRAPHY MIXINS
// ============================================================================

// Fluid typography mixin
// @param {Number} $min-size - Minimum font size
// @param {Number} $max-size - Maximum font size
// @param {Number} $min-vw - Minimum viewport width
// @param {Number} $max-vw - Maximum viewport width
// @example scss
//   @include fluid-type(1rem, 2rem);
@mixin fluid-type(
    $min-size,
    $max-size,
    $min-vw: breakpoint(sm),
    $max-vw: breakpoint(2xl)
) {
    font-size: fn.fluid-size($min-size, $max-size, $min-vw, $max-vw);
}

// Text truncation (single line)
// @example scss
//   @include truncate();
@mixin truncate() {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

// Multi-line text truncation
// @param {Number} $lines - Number of lines to show
// @example scss
//   @include line-clamp(3);
@mixin line-clamp($lines: 2) {
    display: -webkit-box;
    -webkit-line-clamp: $lines;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

// Typography preset mixin
// @param {String} $size - Font size key
// @param {String} $weight - Font weight key
// @param {String} $line-height - Line height key
// @example scss
//   @include typography(lg, semibold, tight);
@mixin typography($size: base, $weight: normal, $line-height: normal) {
    font-size: font-size($size);
    font-weight: font-weight($weight);
    line-height: line-height($line-height);
}

// ============================================================================
// VISUAL EFFECTS MIXINS
// ============================================================================

// Box shadow mixin
// @param {String} $size - Shadow size key (sm, base, lg, etc.)
// @param {Boolean} $dark - Use dark mode shadow
// @example scss
//   @include shadow(lg);
@mixin shadow($size: base, $dark: false) {
    box-shadow: shadow($size, $dark);
}

// Focus ring/outline for accessibility
// @param {Color} $color - Ring color (default: primary)
// @param {Number} $width - Ring width
// @param {Number} $offset - Ring offset
// @example scss
//   @include focus-ring();
@mixin focus-ring($color: hsl(var(--ring)), $width: 2px, $offset: 2px) {
    outline: $width solid $color;
    outline-offset: $offset;
}

// Focus visible state (keyboard navigation only)
// @param {Color} $color - Ring color
// @example scss
//   @include focus-visible();
@mixin focus-visible($color: hsl(var(--ring))) {
    &:focus-visible {
        @include focus-ring($color);
    }

    &:focus:not(:focus-visible) {
        outline: none;
    }
}

// Backdrop blur effect
// @param {Number} $amount - Blur amount
// @example scss
//   @include backdrop-blur(10px);
@mixin backdrop-blur($amount: 10px) {
    backdrop-filter: blur($amount);
    -webkit-backdrop-filter: blur($amount);
}

// ============================================================================
// ANIMATION MIXINS
// ============================================================================

// Transition mixin
// @param {List} $properties - Properties to transition
// @param {String} $duration - Duration key (fast, base, slow)
// @param {String} $timing - Easing key (smooth, ease-in-out, etc.)
// @example scss
//   @include transition(all, base, smooth);
//   @include transition((color, background-color), fast, ease-out);
@mixin transition($properties: all, $duration: base, $timing: smooth) {
    $transitions: ();

    @if meta.type-of($properties) == "list" {
        @each $property in $properties {
            $transitions: list.append(
                $transitions,
                $property transition($duration) easing($timing),
                comma
            );
        }
    } @else {
        $transitions: $properties transition($duration) easing($timing);
    }

    transition: $transitions;
}

// Animation mixin
// @param {String} $name - Animation name
// @param {String} $duration - Duration key
// @param {String} $timing - Easing key
// @param {String} $iteration - Iteration count
// @example scss
//   @include animation(fadeIn, base, smooth, 1);
@mixin animation($name, $duration: base, $timing: smooth, $iteration: 1) {
    animation: $name transition($duration) easing($timing) $iteration;
}

// Hover state with smooth transition
// @param {List} $properties - Properties to transition
// @content - Hover styles
// @example scss
//   @include hover-state((color, background-color)) {
//     color: white;
//     background-color: blue;
//   }
@mixin hover-state($properties: all) {
    @include transition($properties, fast, smooth);

    @media (hover: hover) and (pointer: fine) {
        &:hover {
            @content;
        }
    }
}

// ============================================================================
// COMPONENT MIXINS
// ============================================================================

// Reset button styles
// @example scss
//   @include button-reset();
@mixin button-reset() {
    padding: 0;
    border: none;
    background: none;
    font: inherit;
    color: inherit;
    cursor: pointer;
    outline: none;

    &::-moz-focus-inner {
        border: 0;
        padding: 0;
    }
}

// Reset list styles
// @example scss
//   @include list-reset();
@mixin list-reset() {
    margin: 0;
    padding: 0;
    list-style: none;
}

// Reset link styles
// @example scss
//   @include link-reset();
@mixin link-reset() {
    color: inherit;
    text-decoration: none;

    &:hover {
        text-decoration: none;
    }
}

// Visually hidden (accessible to screen readers)
// @example scss
//   @include visually-hidden();
@mixin visually-hidden() {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

// Card component base styles
// @param {String} $padding - Card padding
// @param {String} $radius - Border radius key
// @param {String} $shadow - Shadow size key
// @example scss
//   @include card(spacing(lg), lg, base);
@mixin card($padding: spacing(lg), $radius: lg, $shadow: base) {
    background-color: hsl(var(--card));
    color: hsl(var(--card-foreground));
    border-radius: radius($radius);
    padding: $padding;
    box-shadow: shadow($shadow);
}

// Button base styles
// @param {String} $padding-x - Horizontal padding
// @param {String} $padding-y - Vertical padding
// @param {String} $radius - Border radius key
// @example scss
//   @include button-base(spacing(xl), spacing(md), base);
@mixin button-base($padding-x: spacing(xl), $padding-y: spacing(md), $radius: base) {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: spacing(sm);
    padding: $padding-y $padding-x;
    border-radius: radius($radius);
    font-size: font-size(base);
    font-weight: font-weight(medium);
    white-space: nowrap;
    cursor: pointer;
    user-select: none;
    border: border-width(thin) solid transparent;

    @include transition((color, background-color, border-color, box-shadow), fast, smooth);
    @include focus-visible();

    &:disabled {
        opacity: 0.5; // opacity(strong) = 0.5
        pointer-events: none;
        cursor: not-allowed;
    }
}

// ============================================================================
// UTILITY MIXINS
// ============================================================================

// Aspect ratio container
// @param {Number} $width - Width ratio
// @param {Number} $height - Height ratio
// @example scss
//   @include aspect-ratio(16, 9);
@mixin aspect-ratio($width, $height) {
    aspect-ratio: #{$width} / #{$height};

    // Fallback for older browsers
    @supports not (aspect-ratio: 1 / 1) {
        position: relative;
        padding-bottom: percentage($height, $width);

        & > * {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    }
}

// Clearfix for floated elements
// @example scss
//   @include clearfix();
@mixin clearfix() {
    &::after {
        content: "";
        display: table;
        clear: both;
    }
}

// Hardware acceleration
// @example scss
//   @include hardware-accelerate();
@mixin hardware-accelerate() {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

// Custom scrollbar styles
// @param {Number} $width - Scrollbar width
// @param {Color} $track-color - Track background color
// @param {Color} $thumb-color - Thumb color
// @example scss
//   @include custom-scrollbar(8px, transparent, hsl(var(--muted)));
@mixin custom-scrollbar($width: 8px, $track-color: transparent, $thumb-color: hsl(var(--muted))) {
    // Firefox
    scrollbar-width: thin;
    scrollbar-color: $thumb-color $track-color;

    // Chrome, Edge, Safari
    &::-webkit-scrollbar {
        width: $width;
        height: $width;
    }

    &::-webkit-scrollbar-track {
        background: $track-color;
    }

    &::-webkit-scrollbar-thumb {
        background-color: $thumb-color;
        border-radius: radius(full);
        border: 2px solid $track-color;

        &:hover {
            background-color: fn.shade($thumb-color, 20%);
        }
    }
}

// Selection styles (text highlight)
// @param {Color} $bg - Background color
// @param {Color} $color - Text color
// @example scss
//   @include selection(hsl(var(--primary)), hsl(var(--primary-foreground)));
@mixin selection($bg: hsl(var(--primary)), $color: hsl(var(--primary-foreground))) {
    ::selection {
        background-color: $bg;
        color: $color;
    }

    ::-moz-selection {
        background-color: $bg;
        color: $color;
    }
}
